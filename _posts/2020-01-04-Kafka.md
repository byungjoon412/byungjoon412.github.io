---
title: Apache Kafka
excerpt : Kafka Introduction
date: 2020-01-04 20:59:10 
header:
  image: /assets/images/kafka.png
  caption: ""
tags:
  - kafka
---
'카프카, 데이터 플랫폼의 최강자'를 참고하여 작성하였습니다.

# Kafka

[![kafka_diagram](/assets/images/kafka_diagram.png)](https://kafka.apache.org)
아파치 카프카(Apache Kafka)는 링크드인에서 개발한 pub-sub 모델의 분산형 메시지 스트리밍 플랫폼으로 현재 오픈소스화 되어 링크드인, 넷플릭스, 우버, 하이퍼레저 패브릭, 카카오 등에서 사용 중입니다.

링크드인 사이트가 성장하며 데이터 시스템이 복잡해지고, 파이프라인이 파편화되어 이를 개선하기 위해 다음을 목표로 새로운 시스템을 만들었습니다.

- 프로듀서와 컨슈머 분리
- 메시징 시스템과 같이 영구 메시지 데이터를 여러 컨슈머에게 허용
- 높은 처리량을 위한 메시지 최적화
- 데이터가 증가함에 따라 스케일아웃이 가능한 시스템

## 기존의 방식

![network](/assets/images/network.png)
Pub-Sub 모델이 아닌 기존의 방식의 경우 A와 B가 각각 C와 D에게 메시지를 보낼 때 직접 통신하는 방식입니다.
![network2](/assets/images/network2.png)
하지만 위와 같이 D와의 통신이 끊기게 되면 전송하는 쪽에선 이를 인지하고 처리하지 않을 경우 메시지는 소실되고 장애를 겪게 될 것입니다. 또한 통신에 참여하는 개체가 많아질 수록 서로 연결하고 전송해야 하기 때문에 확장성도 좋지 못합니다.

이러한 단점을 극복하기 위해 나온 통신 모델이 Pub-Sub 모델입니다.
![Pub-Sub](/assets/images/Pub-Sub_network.png)
Pub-Sub 모델에선 메시지를 대상에게 직접 전달하는 것이 아니라 중간의 다른 시스템을 통하여 통신을 합니다. Publisher는 자신이 보내고자 하는 토픽에 메시지를 보내고 Subscriber는 해당 토픽으로부터 메시지를 가져옵니다.
Subscriber 장애로 인해 메시지를 가져오지 못해도 복구 후 다시 토픽으로부터 메시지를 가져오면 되기 때문에 메시지가 유실되지 않습니다.

## 특징

- Pub-Sub 모델

  카프카는 메시지를 보내는 역할과 받는 역할을 완벽히 구분하여 어느 한쪽에 문제가 생기더라도 다른 시스템에 영향을 끼칠 확률이 낮습니다. 또한 구조가 단순해져 새로운 서버가 추가되더라도 카프카로만 보내거나 받아오면 되기 때문에 확장에 대한 부담도 줄일 수 있습니다.

- Multi Producer, Multi Consumer

  토픽과 프로듀서, 토픽과 컨슈머는 1대1 관계가 아닙니다. 하나의 토픽에 여러 프로듀서와 컨슈머가 접근 가능하고 프로듀서와 컨슈머는 여러 토픽에 접근할 수 있습니다.

- 디스크에 저장

  카프카가 기존의 메시지 시스템과 다른점 중 하나가 디스크에 메시지를 저장하는 것입니다. 일반적인 메시지 시스템은 컨슈머가 메시지를 읽어가면 메시지를 삭제하지만 카프카는 일정 보관 주기동안 메시지를 보관하고 있습니다. 트래픽이 증가하여 컨슈머의 처리가 늦어져도 손실 없이 메시지를 가져갈 수 있고, 이전에 가져갔던 메시지를 다시 가져갈 수도 있습니다.

- 확장성

  카프카는 확장이 용이하도록 설계되어 있습니다. 또한 서비스 중단 없이 온라인 상태에서도 확장이 가능합니다.

- 높은 성능

  카프카는 고성능을 유지하기 위해 내부적으로 분산 처리, 배치 처리 등 다양한 방법을 사용하고 있습니다.

### 용어 정리

- 브로커(Broker) : 카프마 어플리케이션에 설치된 서버 또는 노드.
- 토픽(Topic) : 프로듀서와 컨슈머가 메시지를 구분하기 위한 네임으로 사용.
- 파티션(Partition) :
- 프로듀서(Producer) : 메시지를 생산하여 브로커의 토픽으로 보내는 서버 또는 어플리케이션.
- 컨슈머(Consumer) : 브로커의 토픽으로부터 메시지를 가져가는 서버 또는 어플리케이션.
